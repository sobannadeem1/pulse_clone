import{s as t,x as e,z as s,I as n,i,aR as o,f as a,A as r,bn as l,cT as c}from"./icon-6e78539e.js";import{W as d,_ as m,n as h,e as p,bW as u,q as b,a as v,d as g,gX as C,v as f,gY as y,l as S,f as w,t as _,d3 as k,bC as T,aX as j,du as x,bi as I,cd as A,b as E,c as P,b0 as O,r as L,c0 as D,fR as M,gZ as V,g_ as $,ar as q,e9 as B,g$ as F,g as R,h0 as U,dC as N,dD as z,k as Q,w as H,h1 as J,h2 as K,K as W,h3 as X,h4 as G,bL as Y,ae as Z,h5 as tt,o as et,dE as st,dy as nt,dF as it}from"./shell-97fd3bd7.js";import{C as ot,o as at}from"./shreddit-comment-b2364b0b.js";import{t as rt}from"./throttle-cde4a556.js";import{d as lt,R as ct}from"./shreddit-overflow-report-599e9771.js";import{S as dt}from"./scroll-blocker-0e59bc75.js";import{t as mt}from"./comments-54039841.js";import"./shreddit-spoiler-b908dc52.js";import"./faceplate-render-63f339d7.js";import"./author-flair-event-handler-095f64b6.js";import{B as ht}from"./base-translator-b007e0d7.js";import"./translation-feedback-modal-15727aa7.js";import{g as pt}from"./post-5a1bce5f.js";import"./shreddit-comment-badges-c0c76405.js";import"./mod-notes-opener-3bef7efb.js";import{P as ut}from"./pdp-a697afbf.js";import{R as bt}from"./pdp-comment-search-close-91d931fd.js";import{s as vt,S as gt}from"./search-params-3996b7e8.js";import{S as Ct,a as ft,b as yt}from"./search-dynamic-id-7423d058.js";import"./reddit-feed-462296b7.js";import"./faceplate-search-input-ada820ec.js";import"./faceplate-tooltip-39db132d.js";import"./adjust-search-query-link-ff747a08.js";import"./search-dynamic-id-cache-controller-b26a339b.js";import"./translation-contribution-toggle-086fc8d3.js";import{i as St}from"./index-537f5ccb.js";import"./rpl-dialog-trigger-086c104f.js";import"./rpl-bottom-sheet-1e59f57f.js";import"./faceplate-number-d03c87b2.js";import"./locale-e49f0b05.js";import"./number-ea0536b9.js";import"./cached-intl-e5b35306.js";import"./faceplate-timeago-30dcb7e7.js";import"./relative-date-77173042.js";import"./award-controller-98663d86.js";import"./mention-node-1f73a7b8.js";import"./lexical-1c245d48.js";import"./ui-strings-4cc98385.js";import"./upload-2a30e728.js";import"./upload-to-s3-20316034.js";import"./comment-composer-host-5ddfe3cb.js";import"./rte-toolbar-button-emote-f20046de.js";import"./faceplate-dropdown-menu-ce2ff059.js";import"./popper-controller-1fb20141.js";import"./makeEventDispatcher-28989282.js";import"./postComposerFields-d561cf7a.js";import"./translations-3ae51d70.js";import"./faceplate-checkbox-input-5b9e2865.js";import"./checked-input-element-605d976f.js";import"./faceplate-input-35f305aa.js";import"./input-element-c3273c12.js";import"./form-common-utils-3a6d5fab.js";import"./constants-95a2ecae.js";import"./faceplate-modal-8fdeb7ac.js";import"./automation-rule-triggered-rules-0123e7f8.js";import"./filterNullish-14d2de97.js";import"./avatar-aa81f75f.js";import"./rtjson-d7db35d6.js";import"./dom-37d48515.js";import"./reputation-recaptcha-f5c28624.js";import"./comment-4f666a21.js";import"./modActions-fed0f42b.js";import"./sleep-a1fd43c3.js";import"./faceplate-progress-c2913df5.js";import"./telemetry-event-struct-fef69997.js";import"./outbound-link-tracking-controller-00ec0484.js";import"./classnameUtils-e77f7123.js";import"./common-ui-strings-b2d9b9d8.js";import"./faceplate-textarea-input-a68ea248.js";import"./live-978a02ee.js";import"./text-input-e49faaea.js";import"./faceplate-bottom-sheet-bd14a9d4.js";import"./TinyGesture-6f7cc1aa.js";import"./post-0923bbed.js";import"./distinguished-tags-02527156.js";import"./mod-notes-a25f225c.js";import"./faceplate-text-input-7ffdbd7f.js";import"./faceplate-switch-input-dd3c0cb2.js";import"./contains-1042b204.js";const wt=d(t);let _t=class extends wt{constructor(){super(...arguments),this.commentId="",this.parentCommentPermalink="",this.postPermalink="",this.isInModQueue=!1,this.onLinkClick=(t,e)=>{this.isInModQueue&&(t.stopPropagation(),t.preventDefault(),u?.(b.ModQueuePdpLinkClick,{isFullDiscussionLink:e,parentCommentPermalink:this.parentCommentPermalink,postPermalink:this.postPermalink}))}}static get styles(){return[v,g(".single-comment-thread-toolbar {\n  align-items: center;\n  display: flex;\n  flex-flow: row nowrap;\n  font: var(--font-title-h6);\n  justify-content: space-between;\n  padding: 0.5rem 1rem;\n}\n")]}firstUpdated(){this.updateComplete.then((()=>{if(this.isInModQueue)return;const t=this.getBoundingClientRect().top;window.scrollTo({top:t-48,behavior:"auto"})}))}handleSeeFullDiscussionLink(t){this.onLinkClick(t,!0);const e=document.querySelector("shreddit-post");e&&this.trackEvent(C(e))}render(){if(!this.commentId)return;const t=this.isInModQueue?"View parent comment":"Single comment thread",s="no-underline hover:no-underline visited:no-underline text-primary";return e`\n <div>\n <div class="single-comment-thread-toolbar text-neutral-content-weak">\n ${this.parentCommentPermalink?e`\n <a \n href="${this.parentCommentPermalink}" \n class="${s}" \n @click="${this.onLinkClick}" \n>\n ${t}\n </a>\n `:e` <span>${t}</span> `}\n <span class="flex-1 h-px mx-xs bg-tone-4" data-id="line"></span>\n <a \n href="${this.postPermalink}" \n class="${s}" \n @click="${this.handleSeeFullDiscussionLink}" \n>\n See full discussion\n </a>\n </div>\n </div>\n `}};m([h({type:String,attribute:"comment-id"})],_t.prototype,"commentId",void 0),m([h({type:String,attribute:"parent-comment-permalink"})],_t.prototype,"parentCommentPermalink",void 0),m([h({type:String,attribute:"post-permalink"})],_t.prototype,"postPermalink",void 0),m([h({type:Boolean,attribute:"is-in-modqueue"})],_t.prototype,"isInModQueue",void 0),_t=m([p("shreddit-comments-page-tools")],_t);const kt=f(t);let Tt=class extends kt{constructor(){super(...arguments),this.isVisible=!1}connectedCallback(){super.connectedCallback(),this.enableObserver({threshold:1})}disconnectedCallback(){super.disconnectedCallback(),this.disableObserver()}publishEvent(){u(b.TriggerCommentBlockingAuth,{source:ot.Scroll}),this.disableObserver()}observerIsIntersectingCallback(){this.isVisible||(this.publishEvent(),this.isVisible=!0)}render(){return e`<div></div> `}};Tt=m([p("cbau-trigger")],Tt);const jt=d(w(t));let xt=class extends jt{constructor(){super(...arguments),this.thingId="",this.postId="",this.subredditPrefixedName="",this.isTruncated=!1,this.totalComments=0,this.isProfilePost=!1,this.isReportingEnabled=!1,this.ui="mobile",this.permalink="",this.author="",this.isAuthorDeleted=!1,this.pageUnloaded=!1,this.initialViewStats={num_comments_viewed:0,comments_viewed_json:[],comments_viewed_list:[],num_comments_consumed:0,comments_consumed_json:[],comments_consumed_list:[]},this.view_stats=this.cloneObject(this.initialViewStats),this.correlation_id=k(),this.page_request_id=T(),this.overflowActionsMenuRef=j(),this.scrollBlocker=new dt(this),this._visibilityDetails=null,this.depthUpdated=null,this.handleVisibilityChange=t=>{t?(this.pageUnloaded=!1,this.resetViewStats()):this.pageUnloaded||this.flushEvents()},this.onBeforeUnload=()=>{this.pageUnloaded=!0,this.flushEvents()},this.flushEvents=()=>{const t=((t,e,s,n,i,o)=>{let a={};const r=y("post"),l=e.slice(0,1e3);return a={correlation_id:i,view_stats:{num_comments_viewed:t,comments_viewed_json:JSON.stringify(l),comments_viewed_list:s},post:{...r,number_comments:n},action_info:{page_request_id:o}},S({source:"post",action:"view",noun:"comments"},a)})(this.view_stats.num_comments_viewed,this.view_stats.comments_viewed_json,this.view_stats.comments_viewed_list,this.totalComments,this.correlation_id,this.page_request_id),e=((t,e,s,n,i,o)=>{let a={};const r=y("post"),l=e.slice(0,1e3);return a={correlation_id:i,view_stats:{num_comments_consumed:t,comments_consumed_json:JSON.stringify(l),comments_consumed_list:s},post:{...r,number_comments:n},screen:{height:window?.screen.height,width:window?.screen.width},action_info:{page_request_id:o}},S({source:"post",action:"consume",noun:"comments"},a)})(this.view_stats.num_comments_consumed,this.view_stats.comments_consumed_json,this.view_stats.comments_consumed_list,this.totalComments,this.correlation_id,this.page_request_id);this.trackEvent(t),this.trackEvent(e),this.resetViewStats()},this.commentsViewedListener=t=>{this.updateCommentsViewedStats(t.detail)},this.commentsConsumedListener=t=>{this.updateCommentsConsumedStats(t.detail)},this.handleCloseOverflowActionsMenu=()=>{this.overflowActionsMenuRef.value?.close(),document.documentElement.removeEventListener("click",this.handleCloseOverflowActionsMenu),this.scrollBlocker.unblockPageScrolling()},this.handleCommentCreated=({parentThingId:t,body:e})=>{this.postId===t&&e&&(this.querySelector("#next-comment")?.after(...x(e)),this.totalComments+=1)}}static get styles(){return[v,g(":host {\n  display: block;\n  background-color: var(--shreddit-content-background);\n  padding-bottom: var(--spacer-xs);\n}\n"),g(lt)]}get visibilityDetails(){return null===this._visibilityDetails&&null===this.depthUpdated&&(this.depthUpdated=new Promise((t=>{requestAnimationFrame((()=>{const e=this.getVisibilityDetails();this._visibilityDetails=e,t(e)}))}))),this._visibilityDetails}getVisibilityDetails({containerWidth:t}={}){const e=this.querySelector(":scope > shreddit-comment")?.depth??0;t??(t=this.getBoundingClientRect().width);const s="mobile"===this.ui?232:320,n="mobile"===this.ui?18:32,i="mobile"===this.ui?4:10,o=Math.floor((t-s)/n),a=Math.max(1,Math.min(o,i)),r=a+e,l=this.querySelector(":scope shreddit-comment[is-chosen-mq-comment]"),c=l?.depth??0,d=Math.max(e,c-a+1);return l?{maxVisibleDepth:d+a,minVisibleDepth:d}:{maxVisibleDepth:r}}cloneObject(t){return JSON.parse(JSON.stringify(t))}connectedCallback(){super.connectedCallback(),this.addEventListener(at,this.handleOpenOverflowActionsMenu),this.subscribe(b.CommentCreated,this.handleCommentCreated),this.resizeObserver=new ResizeObserver(rt((t=>{let e=0;for(const s of t){const t=s.contentBoxSize.at(0)?.inlineSize;if(t){e=t;break}}if(0===e)return;const s=this.getVisibilityDetails({containerWidth:e});if(this._visibilityDetails?.maxVisibleDepth!==s.maxVisibleDepth||this._visibilityDetails?.minVisibleDepth!==s.minVisibleDepth){this._visibilityDetails=s,this.depthUpdated=Promise.resolve(s);for(const t of this.querySelectorAll("shreddit-comment"))t.setVisibility(s.maxVisibleDepth,s.minVisibleDepth)}}),128,!0)),this.resizeObserver.observe(this,{box:"content-box"}),this.addEventListener("comments-viewed-event",this.commentsViewedListener),this.addEventListener("comments-consumed-event",this.commentsConsumedListener),I.subscribe(this.onBeforeUnload,{unloadOnly:!0}),A(this.handleVisibilityChange,{immediate:!0}),window.addEventListener("beforeRoute",(()=>{this.flushEvents()}))}resetViewStats(){this.correlation_id=k(),this.view_stats=this.cloneObject(this.initialViewStats)}updateCommentsViewedStats(t){return this.view_stats.comments_viewed_json.find((e=>e.comment_id===t?.detail.comment_id))||(this.view_stats.comments_viewed_json.push({comment_depth:t?.detail.comment_depth,comment_id:t?.detail.comment_id,comment_parent_id:t?.detail.comment_parent_id}),this.view_stats.comments_viewed_list.push(t?.detail.comment_id),this.view_stats.num_comments_viewed=this.view_stats.comments_viewed_json.length),t}updateCommentsConsumedStats(t){return this.view_stats.comments_consumed_json.find((e=>e.comment_id===t?.detail.comment_id))||(this.view_stats.comments_consumed_json.push({comment_depth:t?.detail.comment_depth,comment_id:t?.detail.comment_id,comment_parent_id:t?.detail.comment_parent_id}),this.view_stats.comments_consumed_list.push(t?.detail.comment_id),this.view_stats.num_comments_consumed=this.view_stats.comments_consumed_json.length),t}disconnectedCallback(){super.disconnectedCallback(),I.unsubscribe(this.onBeforeUnload),this.removeEventListener(at,this.handleOpenOverflowActionsMenu),this.unsubscribe(b.CommentCreated,this.handleCommentCreated),this.resizeObserver?.unobserve(this),this.resizeObserver?.disconnect(),this.removeEventListener("comments-viewed-event",this.commentsViewedListener),this.removeEventListener("comments-consumed-event",this.commentsConsumedListener)}showAllComments(){this.publish(b.TriggerCommentBlockingAuth,{source:ot.Button}),this.isTruncated=!1,this.trackEvent(mt())}renderShredtopViewMoreCommentsButton(t){return E({attributes:{type:"button",className:"ml-sm xs:ml-0 font-semibold mt-md",onclick:t},appearance:"brand",shape:"pill",leadingIcon:s({size:n.Medium}),size:P.Small,children:"View more comments"})}renderTruncatedExpandButton(){return this.renderShredtopViewMoreCommentsButton(this.showAllComments)}renderContent(){const t="Comments Section";return e`\n <section \n class="flex flex-col px-md xs:px-0 gap-md relative" \n aria-label="Comments" \n>\n <h1 \n class="absolute -top-full -left-full w-px h-px overflow-hidden" \n aria-label="${t}" \n>\n ${t}\n </h1>\n <slot></slot>\n ${this.isTruncated?"":e`<slot name="truncated"></slot>`}\n </section>\n `}renderExpandButton(){return this.isTruncated?this.renderTruncatedExpandButton():""}render(){return e`\n ${this.renderContent()}\n <faceplate-dialog \n ${O(this.overflowActionsMenuRef)}\n class="overflow-actions-dialog" \n @click="${this.handleCloseOverflowActionsMenu}" \n>\n <faceplate-screen-reader-content id="overflow-actions-menu-label">\n Additional comment actions\n </faceplate-screen-reader-content>\n <ul class="overflow-actions-menu" aria-labelledby="overflow-actions-menu-label">\n <li>\n <a href="${this.permalink}">\n <icon-link-post aria-hidden="true" class="overflow-actions-icon"></icon-link-post>\n Share\n </a>\n </li>\n ${this.isProfilePost?"":e`\n <li>\n <a href="/${this.subredditPrefixedName}/">\n <icon-admin aria-hidden="true" class="overflow-actions-icon"></icon-admin>\n More from ${this.subredditPrefixedName}\n </a>\n </li>\n `}\n ${this.isAuthorDeleted?"":e`<li>\n <a href="/user/${this.author}/">\n <icon-user aria-hidden="true" class="overflow-actions-icon"></icon-user> ${this.author}'s profile\n </a>\n </li>`}\n ${this.isReportingEnabled?e`<li>\n <shreddit-overflow-report \n thingId="${this.thingId}" \n type="${ct.COMMENT}" \n></shreddit-overflow-report>\n </li>`:""}\n <button \n class="button button-small button-plain block bg-tone-6 text-tone-3 mt-[10px] mx-auto mb-0 w-[calc(100%-20px)] max-w-full" \n>\n Close\n </button>\n </ul>\n </faceplate-dialog>\n ${this.renderExpandButton()}\n `}handleOpenOverflowActionsMenu({detail:{author:t,isAuthorDeleted:e,permalink:s,thingId:n}}){this.author=t,this.isAuthorDeleted=e,this.permalink=s,this.thingId=n,this.overflowActionsMenuRef.value?.showModal(),document.documentElement.addEventListener("click",this.handleCloseOverflowActionsMenu),this.scrollBlocker.blockPageScrolling()}};m([h({type:String})],xt.prototype,"thingId",void 0),m([h({type:String,attribute:"post-id"})],xt.prototype,"postId",void 0),m([h({type:String,attribute:"subreddit-prefixed-name"})],xt.prototype,"subredditPrefixedName",void 0),m([h({type:Boolean})],xt.prototype,"isTruncated",void 0),m([h({type:Number})],xt.prototype,"totalComments",void 0),m([h({type:Boolean})],xt.prototype,"isProfilePost",void 0),m([h({type:Boolean,attribute:"is-reporting-enabled"})],xt.prototype,"isReportingEnabled",void 0),m([h({type:String,attribute:"ui"})],xt.prototype,"ui",void 0),m([_()],xt.prototype,"permalink",void 0),m([_()],xt.prototype,"author",void 0),m([_()],xt.prototype,"isAuthorDeleted",void 0),xt=m([p("shreddit-comment-tree")],xt);let It=class extends t{constructor(){super(),this.postId="",this.handleCommentCreated=({postId:t})=>{t===this.postId&&this.remove()},this.pubsub=new L(this)}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(b.CommentCreated,this.handleCommentCreated)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(b.CommentCreated,this.handleCommentCreated)}render(){return e`<slot></slot>`}};It.styles=[i`:host{display:contents}`,v],m([h({type:String,attribute:"post-id"})],It.prototype,"postId",void 0),It=m([p("comment-forest-empty-state")],It);let At=class extends ht{constructor(){super(...arguments),this.mtSeoLanguage="",this.isSeoVisit=!1,this.isLoadingTranslations=!1,this._partialRequestController=new D(this),this.seoVisitSettled=!1,this.pubsub=new L(this),this.onPostTranslationOverride=t=>{"PDP"===t.pageType&&(t.isTranslationActive?this.onTranslationsEnabled():this.onTranslationsDisabled())},this.onCommentTranslationOverride=t=>{this.onCommentTranslationToggle(t.id,t.isTranslationActive)}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(b.I18nPostTranslationOverride,this.onPostTranslationOverride,!1),this.pubsub.subscribe(b.I18nCommentTranslationOverride,this.onCommentTranslationOverride,!1),this.addEventListener(M,this.handleTranslationFeedback)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(b.I18nPostTranslationOverride,this.onPostTranslationOverride),this.pubsub.unsubscribe(b.I18nCommentTranslationOverride,this.onCommentTranslationOverride)}updated(t){t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&(this.seoVisitSettled||!this.isSeoVisit?super.onUpdateTranslationContextValue(t):this.seoVisitSettled=!0)}async onCommentTranslationToggle(t,e){const s=this.getCommentMetadataById(t);if(!s||!s.isTranslatable)return;const n=this.objectTranslationCache.get(t);if(!(e?!!n?.translatedElement:!!n?.originalElement)){const s=await this.fetchComments([t],e?"translated":"original");this.storeCommentTranslationCache(s)}this.renderTranslationCache(e,t)}async onTranslationsEnabled(){const t=await this.runTranslations(!0);V(!0),$(!0,this.mtSeoLanguage),this.submitTranslationMetrics(),this.toggleObserverForComments(t.fetchedComments)}async onTranslationsDisabled(){const t=await this.runTranslations(!1);V(!1),$(!1,this.mtSeoLanguage),this.submitTranslationMetrics(),this.toggleObserverForComments(t.fetchedComments)}async runTranslations(t){const e=t??!!this.translationContextValue.isTranslationActive,s=this.getCommentsMetadata();this.storeCommentTranslationCache(s.map((t=>({id:t.id,translation:t.isTranslated?t.slot.innerHTML:void 0,original:t.isTranslated?void 0:t.slot.innerHTML}))));const n=[];this.objectTranslationCache.forEach(((t,s)=>{(e&&!t.translatedElement||!e&&!t.originalElement)&&n.push(s)}));let i=[];return n.length&&(i=await this.fetchComments(n,e?"translated":"original"),this.storeCommentTranslationCache(i||[])),this.renderTranslationCache(e),{fetchedComments:i}}getCommentMetadataById(t){const e=this.querySelector(`shreddit-comment[thingid="${t}"]`);if(e)return this.getCommentMetadata(e)}getCommentsMetadata(){const t=this.querySelectorAll("shreddit-comment");return Array.from(t).filter((t=>{const e=t.getAttribute("thingid"),s=null!==t.getAttribute("is-translatable"),n=t.querySelector('div[slot="comment"]');return!!e&&s&&!!n})).map((t=>this.getCommentMetadata(t)))}getCommentMetadata(t){return{id:t.getAttribute("thingid"),isTranslated:null!==t.getAttribute("is-comment-translated"),isTranslatable:null!==t.getAttribute("is-translatable"),element:t,slot:t.querySelector('div[slot="comment"]'),cache:this.objectTranslationCache.get(t.getAttribute("thingid"))}}async fetchComments(t,e){const s=new FormData;t.forEach((t=>s.append("commentIds[]",t))),s.append("includeTranslation","translated"===e?"true":"false");const n=await this.fetchRequestPartial("/svc/shreddit/translated-comment/",{method:q.Post,body:s});return n?this.parseFetchCommentResponse(n):[]}parseFetchCommentResponse(t){return t.map((t=>{const e=t.getAttribute("data-comment-id"),s=t.querySelector(`[data-translated-comment-id="${e}"]`)?.querySelector(`#${e}-translated-post-rtjson-content`),n=t.querySelector(`[data-original-comment-id="${e}"]`)?.querySelector(`#${e}-post-rtjson-content`),i=t=>t?`<div class="py-0 xs:mx-xs mx-2xs inline-block">${t}</div>`:void 0;return{id:e,original:i(n?.innerHTML),translation:i(s?.innerHTML)}}))}storeCommentTranslationCache(t){t.forEach((t=>{this.updateTranslationCache(t.id,{originalElement:t.original?{content:t.original}:void 0,translatedElement:t.translation?{content:t.translation}:void 0})}))}renderTranslationCache(t,e){const s=t??!!this.translationContextValue.isTranslationActive;(e?[this.getCommentMetadataById(e)]:this.getCommentsMetadata()).filter((t=>t&&t.isTranslated!==s&&(s?!!t.cache?.translatedElement:!!t.cache?.originalElement))).forEach((t=>{const e=s?t.cache.translatedElement:t.cache.originalElement;t.slot.innerHTML=e?.content||"",s?t.element.setAttribute("is-comment-translated","true"):t.element.removeAttribute("is-comment-translated")}))}handleTranslationFeedback(t){const{postId:e,commentId:s}=t.detail,n=document.querySelector("shreddit-post"),i=n?.querySelector('[slot="title"]'),o=n?.querySelector('[slot="text-body"]'),a=this.shadowRoot?.getElementById(B.ID.PDP_COMMENT_FEEDBACK_MODAL);a&&a.show?.({post:{id:pt(e),title:i?.textContent?.trim(),body_text:o?.textContent?.trim(),translation_state:this.translationContextValue.isTranslationActive},comment:{id:s,post_id:pt(e),translation_state:this.translationContextValue.isTranslationActive}})}toggleObserverForComments(t){t?.forEach((t=>{const e=document.querySelector(`shreddit-comment[thingid="${t.id}"]`);e&&e?.addTranslationToggledObserver?.('div[slot="comment"]')}))}submitTranslationMetrics(){if(!this.reportMetrics)return;const t=this.querySelectorAll("shreddit-comment"),e=this.translationContextValue?.isTranslationActive||!1,s={},n=[];t.length&&Array.from(t).filter((t=>{const s=this.getCommentMetadata(t);if(!t)return;const i=s.slot.textContent||"",o=s.cache;let a=e?"":i,r=e?i:"";o&&(a=o.originalElement?.content||a,r=o.translatedElement?.content||r),n.push({id:s.id,originalBody:a,translatedBody:r,isTranslated:s.isTranslated,isTranslatable:s.isTranslatable})})),s.scenario=this.metricsScenario,s.comments=F(e,n),this.dispatchEvent(R(U,s))}render(){return e`\n <div><slot></slot></div>\n <translation-feedback-modal \n id="${B.ID.PDP_COMMENT_FEEDBACK_MODAL}" \n></translation-feedback-modal>\n `}};m([h({type:String,attribute:"mt-seo-language"})],At.prototype,"mtSeoLanguage",void 0),m([h({type:Boolean,attribute:"is-seo-visit"})],At.prototype,"isSeoVisit",void 0),At=m([p("comment-translator")],At);let Et=class extends t{constructor(){super(),this.target="",this.path="",this.replaceComments=async({sort:t="",filter:e="",entityFilterId:s=""})=>{t!==this.getCurrentSort()&&this.updateLocation({sort:t});const n=new URL(`${location.origin}${this.path}`);t&&n.searchParams.set(ut.Sort,t.toLowerCase()),e&&n.searchParams.set(ut.Filter,e.toLowerCase()),s&&n.searchParams.set(ut.EntityFilterId,s),n.searchParams.set(ut.InlineRefresh,"true");const i=n.toString().substring(location.origin.length);this.replaceContentController.loadAndReplaceContent({src:i,target:this.target,afterSuccess:()=>N(this,{message:"The comments are sorted successfully",options:{priority:z.assertive}}),afterFailure:()=>this.dispatchEvent(R("faceplate-alert",{level:Q.error,message:"Failed to load the comments."}))})},this.handleCommentFilterUpdated=({sort:t,filter:e,entityFilterId:s})=>{let n=s;s&&s===this.getCurrentEntityFilterId()&&(n=void 0),this.replaceComments({entityFilterId:n,filter:e??this.getCurrentFilter(),sort:t??this.getCurrentSort()})},this.handleSortEvent=async t=>{this.replaceComments({sort:t.detail.selected?.toLowerCase(),filter:this.getCurrentFilter()}),this.pubsub.publish(b.CommentSort,{sort:t.detail.selected})},this.handleClickEvent=async t=>{const e=t.target?.getAttribute("value");e&&(this.replaceComments({filter:e,sort:this.getCurrentSort()}),t.preventDefault())},this.replaceContentController=new bt,this.pubsub=new L(this)}updateLocation({sort:t}){const e=new URL(location.href);e.searchParams.set(ut.Sort,t.toLowerCase()),history.replaceState({},"",e.toString())}getCurrentFilter(){return this.querySelector("[faceplate-tab-selected]")?.getAttribute("value")?.toLowerCase()||""}getCurrentSort(){return new URLSearchParams(location.search).get(ut.Sort)||""}getCurrentEntityFilterId(){return document.querySelector("named-entity-filter-group")?.activeEntityFilterId}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(b.CommentFilterUpdated,this.handleCommentFilterUpdated),this.querySelector("shreddit-sort-dropdown")?.addEventListener("comment-sort",this.handleSortEvent),this.querySelector("faceplate-tabgroup")?.addEventListener("click",this.handleClickEvent)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(b.CommentFilterUpdated,this.handleCommentFilterUpdated),this.querySelector("shreddit-sort-dropdown")?.removeEventListener("comment-sort",this.handleSortEvent),this.querySelector("faceplate-tabgroup")?.removeEventListener("click",this.handleClickEvent)}render(){return e`<slot></slot>`}};m([h({type:String})],Et.prototype,"target",void 0),m([h({type:String})],Et.prototype,"path",void 0),Et=m([p("shreddit-comments-sort-dropdown")],Et);let Pt=class extends t{constructor(){super(...arguments),this.target="",this.path="",this.showOnLoad=!1,this.initialValue="",this.commentComposerSelector=J.commentComposerHost,this.addCommentButton=J.addCommentButton,this.pdpCommentsSortSelector=J.pdpCommentsTreeSortContainer,this.pdpAmaCommentTabSelector=J.pdpAmaCommentTabWrapper,this.shredditCommentsSortSelector=J.shredditCommentsSortDropdown,this.open=this.showOnLoad,this.commentSearchActive=this.showOnLoad,this.focusSearchInput=()=>{this.open||(this.open=!0),this.searchInput?.innerInput?.focus()},this.resetSearchInput=()=>{this.handleClear(),this.open=!1,Ct.update(K.PdpCommentSearch),this.commentSearchActive=!1,this.expandSearchButton?.focus()},this.replaceContentController=new bt,this.handlePdpCommentSearch=W((async()=>{const t=this.searchInput?.value??"";if(t){this.commentSearchActive=!0;const e={conversationId:ft.get(K.PdpCommentSearch),impressionId:Ct.getUUID(),query:t,scope:{type:X.PDP,path:this.path},cursor:{},type:G.Comments};this.addSearchParamsToUrl(e);const s=new URLSearchParams({...vt(e)});Y(this,S({source:"search",action:"click",noun:"full_search_button"},this.searchTelemetryData));const n=document.createElement("span");n.id=this.target,this.replaceContentController.loadAndReplaceContent({src:`/svc/shreddit${this.path}pdp-comment-search-results?${s.toString()}`,target:this.target,wrapPartialElement:t=>(n.appendChild(t),n)})}}),300),this.handleKeyDown=t=>{Ct.update(K.PdpCommentSearch),"Enter"===t.key&&t.target===this.searchInput&&this.handlePdpCommentSearch(),"Escape"===t.key&&t.target===this.searchInput&&(t.stopPropagation(),this.commentSearchActive?this.searchInput?.blur():this.resetSearchInput())},this.handleClear=()=>{this.searchInput?.value&&(this.searchInput.value="")}}hideElementsVisibility(t){document.querySelector(this.commentComposerSelector)?.classList.toggle("hidden",t),document.querySelector(this.addCommentButton)?.classList.toggle("hidden",t),document.querySelector(this.pdpCommentsSortSelector)?.classList.toggle("hidden",t),document.querySelector(this.pdpAmaCommentTabSelector)?.classList.toggle("hidden",t),document.querySelector(this.shredditCommentsSortSelector)?.classList.toggle("flex",!t)}connectedCallback(){super.connectedCallback(),this.commentSearchActive=this.showOnLoad,this.open=this.showOnLoad,this.hideElementsVisibility(this.showOnLoad)}get searchTelemetryData(){const t=this.searchInput?.value??"";return{action_info:{page_type:Z.PostDetail},search:{conversation_id:ft.get(K.PdpCommentSearch),impression_id:Ct.get(K.PdpCommentSearch),query:t,query_id:yt.get({query:t,scope:{type:X.PDP,path:this.path},type:G.Comments},K.PdpCommentSearch),origin_element:tt.CommentSearchBar,origin_page_type:Z.PostDetail}}}addSearchParamsToUrl(t){const e=location.href,s=new URL(e);s.searchParams.set(gt.Query,t.query),s.searchParams.set(gt.Type,t.type),s.searchParams.set(gt.ConversationId,t.conversationId??ft.get(K.PdpCommentSearch)),s.searchParams.set(gt.ImpressionId,t.impressionId??Ct.getUUID());const n=s.toString();n!==e&&history.replaceState({},"",n)}updated(t){if(t.has("open")){const e=!t.get("open")&&this.open,s=t.get("open")&&!this.open;e?this.focusSearchInput():s&&this.expandSearchButton?.focus()}this.hideElementsVisibility(this.commentSearchActive||this.open)}render(){const t="Search Comments";return e`<div \n class="block ml-xs" \n data-faceplate-tracking-context="${JSON.stringify(this.searchTelemetryData)}" \n>\n <faceplate-tracker source="search" action="click" noun="search_bar">\n ${E({appearance:"bordered",attributes:{"aria-controls":"pdp-comment-search-form","aria-expanded":`${this.open}`,className:"border-neutral-border-weak hover:border-neutral-content-weak text-secondary-weak font-normal "+(this.open?"hidden":""),id:"expand-pdp-comment-search-button",onclick:this.focusSearchInput,type:"button"},children:e`<span class="flex pr-xs">${t}</span>`,leadingIcon:e`<span class="flex pl-xs" \n>${o({size:n.Small})}</span>`,screenReaderContent:"Expand comment search"})}\n </faceplate-tracker>\n <form \n class="flex w-full ${et({hidden:!this.open})}" \n id="pdp-comment-search-form" \n @submit="${this.handlePdpCommentSearch}" \n>\n <faceplate-search-input \n class="text-secondary-plain m-0 rounded-full outline outline-1 outline-neutral-border-weak flex-grow focus:outline-neutral-content-weak" \n placeholder="${t}" \n @keydown="${this.handleKeyDown}" \n @focus="${()=>{this.open=!0}}" \n value="${this.initialValue}" \n>\n ${E({attributes:{id:"search-input-clear-button",slot:"clearIcon",type:"button",onclick:this.handleClear},appearance:"plain",size:P.Small,screenReaderContent:"Clear search",leadingIcon:a({size:n.Small})})}</faceplate-search-input>\n ${E({appearance:"plain",attributes:{className:"ml-xs"+(this.commentSearchActive?" hidden":""),id:"cancel-pdp-comment-search-button",onclick:this.resetSearchInput,type:"button"},children:"Cancel"})}\n </form>\n </div>`}};Pt.styles=[v],m([h({type:String})],Pt.prototype,"target",void 0),m([h({type:String})],Pt.prototype,"path",void 0),m([h({attribute:"show-on-load",type:Boolean})],Pt.prototype,"showOnLoad",void 0),m([h({type:String,attribute:"initial-value"})],Pt.prototype,"initialValue",void 0),m([h({type:String,attribute:"comment-composer-selector"})],Pt.prototype,"commentComposerSelector",void 0),m([h({type:String,attribute:"add-comment-button"})],Pt.prototype,"addCommentButton",void 0),m([h({type:String,attribute:"pdp-comments-sort-selector"})],Pt.prototype,"pdpCommentsSortSelector",void 0),m([h({type:String,attribute:"pdp-ama-comments-tab-selector"})],Pt.prototype,"pdpAmaCommentTabSelector",void 0),m([h({type:String,attribute:"shreddit-comments-sort-dropdown-selector"})],Pt.prototype,"shredditCommentsSortSelector",void 0),m([H("#expand-pdp-comment-search-button")],Pt.prototype,"expandSearchButton",void 0),m([H("faceplate-search-input")],Pt.prototype,"searchInput",void 0),m([_()],Pt.prototype,"open",void 0),m([_()],Pt.prototype,"commentSearchActive",void 0),Pt=m([p("pdp-comment-search-input")],Pt);let Ot=class extends t{constructor(){super(...arguments),this.commentId="",this.dedupe=!1,this.pubsub=new L(this),this.loadInAd=()=>{if(!this.shadowRoot||this.shadowRoot.childNodes.length>0)return;const t=document.querySelector(`shreddit-comment-tree-ads > template#comment-tree-ad_${this.commentId}`),e=t?.content.querySelector("shreddit-comments-page-ad");t&&e&&this.isNotADuplicate(e)&&(this.shadowRoot.replaceChildren(t.content.cloneNode(!0)),e.hasAttribute("is-blank")||this.removeAttribute("class"))},this.isNotADuplicate=t=>{if(!this.dedupe||t.hasAttribute("is-blank"))return!0;const e=document.querySelector("shreddit-comments-page-ad");return!e||t.getAttribute("campaign-id")!==e.getAttribute("campaign-id")}}connectedCallback(){super.connectedCallback(),this.commentId&&(this.loadInAd(),this.pubsub.subscribe(b.CommentTreeAdsLoaded,this.loadInAd))}disconnectedCallback(){this.commentId&&this.pubsub.unsubscribe(b.CommentTreeAdsLoaded,this.loadInAd),super.disconnectedCallback()}render(){return r}};Ot.styles=[v],m([h({type:String,attribute:"comment-id"})],Ot.prototype,"commentId",void 0),m([h({type:Boolean,attribute:"dedupe"})],Ot.prototype,"dedupe",void 0),Ot=m([p("shreddit-comment-tree-ad")],Ot);let Lt=class extends t{constructor(){super(...arguments),this.translationContextValue=nt,this.pubsub=new L(this),this.onPostTranslationOverride=t=>{t.id===this.postId&&(this.postTranslationOverrideActive=t.isTranslationActive,this.commentTranslationOverrideActive=void 0)},this.onCommentTranslationOverride=t=>{t.id===this.commentId&&(this.commentTranslationOverrideActive=t.isTranslationActive)}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(b.I18nCommentTranslationOverride,this.onCommentTranslationOverride,!1),this.pubsub.subscribe(b.I18nPostTranslationOverride,this.onPostTranslationOverride,!1),this.isMTSEOUserPage=St()}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(b.I18nCommentTranslationOverride,this.onCommentTranslationOverride),this.pubsub.unsubscribe(b.I18nPostTranslationOverride,this.onPostTranslationOverride)}render(){const t=this.isMTSEOUserPage||!!this.translationContextValue.isTranslationActive,s=this.postTranslationOverrideActive,i=this.commentTranslationOverrideActive,o="boolean"==typeof s?"boolean"==typeof i&&i!==s:"boolean"==typeof i&&i!==t,a=!!o&&!i;return o?e`<div \n class="flex items-center text-neutral-content-weak" \n data-testid="comment-translation-status-icon" \n>\n ${!!o&&i?l({size:n.ExtraSmall,attributes:{"data-testid":"comment-translation-status-icon-translated-icon","aria-label":"Comment is translated"}}):r}\n ${a?c({size:n.ExtraSmall,attributes:{"data-testid":"comment-translation-status-icon-original-icon","aria-label":"Comment is in original language",className:a?"":"hidden"}}):r}\n </div>`:r}};Lt.styles=[v],m([st({context:it,subscribe:!0}),_()],Lt.prototype,"translationContextValue",void 0),m([_()],Lt.prototype,"commentTranslationOverrideActive",void 0),m([_()],Lt.prototype,"postTranslationOverrideActive",void 0),m([_()],Lt.prototype,"isMTSEOUserPage",void 0),m([h({type:String,attribute:"comment-id"})],Lt.prototype,"commentId",void 0),m([h({type:String,attribute:"post-id"})],Lt.prototype,"postId",void 0),Lt=m([p("comment-translation-status-icon")],Lt);
//# sourceMappingURL=comment-forest-client-js-605bc15c.js.map
