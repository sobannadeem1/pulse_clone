import"./shreddit-post-73ddbe00.js";import"./shreddit-post-flair-8b221e09.js";import"./faceplate-progress-c2913df5.js";import"./follow-button-a95f9291.js";import"./mod-note-overflow-menu-f412764a.js";import"./achievements-entrypoint-146ef9e2.js";import"./reddit-chat-anchor-c92258c1.js";import{_ as t,t as e,n as s,e as i,c0 as a,ed as o,eb as r,e9 as n,ba as l,en as d,du as c,ec as p,ar as u,eg as m,g as h,eh as b,ee as f,a as T,b as S,c as g,bX as C}from"./shell-97fd3bd7.js";import{B as j}from"./base-translator-b007e0d7.js";import"./translation-feedback-modal-15727aa7.js";import{x as y,s as v,A as M,b$ as A,I as x,d4 as I,i as E}from"./icon-6e78539e.js";import"./shreddit-post-translator-e63927c8.js";import"./pdp-back-button-1a18846a.js";import{a as k}from"./ama-859a7489.js";import{p as P}from"./pluralize-b19aff3b.js";import"./faceplate-timeago-30dcb7e7.js";import"./faceplate-date-eecb5fe9.js";import"./locale-e49f0b05.js";import"./faceplate-number-d03c87b2.js";import"./number-ea0536b9.js";import"./cached-intl-e5b35306.js";import"./content-action-button-1a352624.js";import"./award-controller-98663d86.js";import"./award-0a36dd03.js";import"./awardsTelemetryState-6bc10f54.js";import"./rpl-tooltip-5d523a91.js";import"./contains-1042b204.js";import"./localStorageByUser-b42ae06f.js";import"./sleep-a1fd43c3.js";import"./modActions-fed0f42b.js";import"./content-tags-95a5dd5f.js";import"./postUpdate-8ca75f4f.js";import"./shreddit-post-share-button-442e4f97.js";import"./list-item-5402a18e.js";import"./with-share-7b821f94.js";import"./a-a70bf2df.js";import"./index-6b6f75e3.js";import"./custom-event-8a5c1c61.js";import"./add-removal-reason-modal-343292be.js";import"./modActions-809aa1ca.js";import"./keyed-f824b392.js";import"./faceplate-form-e41fcc5c.js";import"./form-common-utils-3a6d5fab.js";import"./comment-4f666a21.js";import"./post-5a1bce5f.js";import"./post-0923bbed.js";import"./faceplate-input-35f305aa.js";import"./input-element-c3273c12.js";import"./dropdownButton-6f244e38.js";import"./faceplate-dropdown-menu-ce2ff059.js";import"./popper-controller-1fb20141.js";import"./makeEventDispatcher-28989282.js";import"./faceplate-menu-70580087.js";import"./faceplate-modal-8fdeb7ac.js";import"./faceplate-textarea-input-a68ea248.js";import"./live-978a02ee.js";import"./text-input-e49faaea.js";import"./constants-95a2ecae.js";import"./remove-highlighted-post-438e315a.js";import"./utils-147dae00.js";import"./pdp-a697afbf.js";import"./throttle-cde4a556.js";import"./faceplate-shimmer-376b8b19.js";import"./click-card-fb606e2e.js";import"./faceplate-hovercard-eb17f52a.js";import"./faceplate-tooltip-39db132d.js";import"./outbound-link-tracking-controller-00ec0484.js";import"./utils-49bdc0e1.js";import"./events-82e64833.js";import"./overflow-menu-actions-e2cd8835.js";import"./shreddit-overflow-report-599e9771.js";import"./v2-events-947b4110.js";import"./index-16432d42.js";import"./lexical-1c245d48.js";import"./display-theme-7e251d41.js";import"./rtjson-d7db35d6.js";import"./classnameUtils-e77f7123.js";import"./faceplate-carousel-clone-91917a6e.js";import"./faceplate-pagination-indicator-48962bdd.js";import"./TinyGesture-6f7cc1aa.js";import"./index-b5439860.js";import"./index-537f5ccb.js";import"./translations-3ae51d70.js";import"./faceplate-bottom-sheet-bd14a9d4.js";import"./faceplate-banner-3946df02.js";import"./relative-date-77173042.js";const q={TITLE:"title",TEXT_BODY:"text-body",TRANSLATION_SUFFIX:"-translated",TRANSLATION_ERROR:"#post-translation-error",STILL_IMAGE:`.${f}`,MEDIA_URL:"#media-url",MEDIA_FULLSIZE_URL:"#media-fullsize-url",SRC_SET:"#src-set",ZOOMABLE_IMG:"zoomable-img"};let D=class extends j{constructor(){super(),this.translatorChildrenName="shreddit-post",this.seoVisitSettled=!1,this.isSeoVisit=!1,this.translationState={originalMediaSrcset:"",originalMediaUrl:"",originalMediaFullsizeUrl:"",translatedMediaUrl:"",translatedMediaSrcset:"",translatedMediaFullsizeUrl:""},this._partialRequest=new a(this)}connectedCallback(){super.connectedCallback();const t=this.querySelector(this.translatorChildrenName);t&&this.translationContextValue.isTranslationActive&&t.isPostTranslated&&this.trackEvent(this,o(t,!0)),this.addEventListener(r,this.handleTranslationFeedback)}updated(t){t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&(this.seoVisitSettled||!this.isSeoVisit?super.onUpdateTranslationContextValue(t):this.seoVisitSettled=!0)}handleTranslationFeedback(t){const e=this.translationContextValue.isTranslationActive,s=this.querySelector(this.translatorChildrenName),i=s?.id,a=s?.querySelector(e?'[slot="title-translated"]':'[slot="title"]'),o=s?.querySelector(e?'[slot="text-body-translated"]':'[slot="text-body"]'),r=this.shadowRoot?.getElementById(n.ID.PDP_POST_FEEDBACK_MODAL);r&&r.show?.({post:{id:i,title:a?.textContent?.trim(),body_text:o?.textContent?.trim(),translation_state:e}})}async onTranslationsEnabled(){this.togglePostTranslations(!0),this.submitTranslationMetrics()}async onTranslationsDisabled(){this.togglePostTranslations(!1),this.submitTranslationMetrics()}async togglePostTranslations(t){const e=this.findTranslatablePost(t);if(!e)return this.logError({error:"post not found"});if(e.isTranslationFetched)return this.trackEvent(this,o(e,t)),this.toggleMediaTranslation(t),void(e.isPostTranslated=t);if(!e.isTranslatable&&e.postType!==l.Image)return;const s=await this.loadPostTranslations(e,t);if(!(s&&!1===s.includes?.(d)))return this.logError({error:"api error",metadata:{id:e.id,isTranslationActive:t}});e.isTranslatable&&this.trackEvent(this,o(e,t));const i=c(s);this.appendResponseToPost(e,i),this.storeMediaResponseToCache(i,t),this.toggleMediaTranslation(t)}findTranslatablePost(t){const e=this.querySelector(this.translatorChildrenName);if(!(!e||e.isPostTranslated&&t))return e}async loadPostTranslations(t,e){if(t.isTranslatable||t.postType===l.Image){const s=e?p.GetTranslation:p.GetOriginal,i=new FormData;i.append("postId",t.id),i.append("translationState",s),t.isTranslatable&&i.append("isTranslatable","true");const a="/svc/shreddit/translated-post/";return(await this._partialRequest.request(a,{method:u.Post,body:i}))?.text()}}appendResponseToPost(t,e){if(!t.isTranslatable)return;let s=!1;const i=t.isPostTranslated?[q.TITLE,q.TEXT_BODY]:[`${q.TITLE}${q.TRANSLATION_SUFFIX}`,`${q.TEXT_BODY}${q.TRANSLATION_SUFFIX}`];e.forEach((e=>{const a=e.getAttribute("slot")||"";a.includes(q.TEXT_BODY)&&this.isDevPlatformPost()||i.includes(a)&&!t.querySelector(`[slot="${a}"]`)&&(t.appendChild(e),s=!0)})),s&&(t.isTranslationFetched=!0,this.translationContextValue.isTranslationActive?(t.isPostTranslated=!0,t.isPostBodyTranslated=!0):(t.isPostTranslated=!1,t.isPostBodyTranslated=!1))}storeMediaResponseToCache(t,e){const s=document.querySelector(q.STILL_IMAGE),i=document.querySelector(q.ZOOMABLE_IMG)?.querySelector("img");let a,o,r;t.forEach((t=>{t.id===q.MEDIA_URL.slice(1)&&(a=t.textContent||""),t.id===q.SRC_SET.slice(1)&&(r=t.textContent||""),t.id===q.MEDIA_FULLSIZE_URL.slice(1)&&(o=t.textContent||"")})),a&&r&&(e?(this.translationState.originalMediaUrl=s?.getAttribute("src")||"",this.translationState.originalMediaSrcset=s?.getAttribute("srcset")||"",this.translationState.originalMediaFullsizeUrl=i?.getAttribute("src")||"",this.translationState.translatedMediaUrl=a,this.translationState.translatedMediaSrcset=r,this.translationState.translatedMediaFullsizeUrl=o??""):(this.translationState.originalMediaUrl=a,this.translationState.originalMediaSrcset=r,this.translationState.originalMediaFullsizeUrl=o??"",this.translationState.translatedMediaUrl=s?.getAttribute("src")||"",this.translationState.translatedMediaSrcset=s?.getAttribute("srcset")||"",this.translationState.translatedMediaFullsizeUrl=i?.getAttribute("src")||""))}toggleMediaTranslation(t){if(!this.isMediaCacheStored())return;const e=document.querySelector(q.STILL_IMAGE),s=document.querySelector(q.ZOOMABLE_IMG)?.querySelector("img");t?(e?.setAttribute("src",this.translationState.translatedMediaUrl),e?.setAttribute("srcset",this.translationState.translatedMediaSrcset),s?.setAttribute("src",this.translationState.translatedMediaFullsizeUrl)):(e?.setAttribute("src",this.translationState.originalMediaUrl),e?.setAttribute("srcset",this.translationState.originalMediaSrcset),s?.setAttribute("src",this.translationState.originalMediaFullsizeUrl))}isMediaCacheStored(){return!!this.translationState.translatedMediaUrl&&!!this.translationState.originalMediaUrl}isDevPlatformPost(){return null!==this.querySelector("shreddit-devvit-ui-loader")}submitTranslationMetrics(){if(!this.reportMetrics)return;const t=this.querySelector("shreddit-post");if(!t)return;const{id:e,postType:s="",isPostTranslated:i,isTranslatable:a,isPostBodyTranslated:o}=t,r=this.translationContextValue?.isTranslationActive||!1,n={},l=t.querySelector('[slot="title"')?.textContent||"",d=t.querySelector('[slot="title-translated"')?.textContent||"",c=t.querySelector('[slot="text-body"]')?.textContent||"",p=t.querySelector('[slot="text-body-translated"]')?.textContent||"",u=""!==c||""!==p;n.scenario=this.metricsScenario,n.targetLanguage=t.translationLanguage,n.post=m({postId:e,postType:s,translationSetting:r,originalTitle:l,translatedTitle:d,originalBody:c,translatedBody:p,isTitleTranslated:i,isBodyTranslated:u?o:i,isTranslatable:a}),this.dispatchEvent(h(b,n))}render(){return y`\n <div><slot></slot></div>\n <translation-feedback-modal \n id="${n.ID.PDP_POST_FEEDBACK_MODAL}" \n></translation-feedback-modal>\n `}};t([s({type:Boolean,attribute:"is-seo-visit"})],D.prototype,"isSeoVisit",void 0),t([e()],D.prototype,"translationState",void 0),D=t([i("post-translator")],D);let w=class extends v{constructor(){super(...arguments),this.isSetup=!1,this.hasPrevious=!1,this.hasNext=!1,this.feedData=[],this.currentIndex=-1,this.setup=()=>{const t=Array.from(document.querySelectorAll("[slot=mod-queue-feed] mod-queue-list-item, [slot=mod-queue-feed] shreddit-post, [slot=mod-queue-feed] shreddit-profile-comment")).map((t=>t.getAttribute("comment-id")||t.getAttribute("id"))).filter(Boolean);t.length>0&&(this.feedData=t,this.currentIndex=this.feedData.findIndex((t=>t===this.thingId)),this.hasPrevious=this.currentIndex>0,this.hasNext=this.currentIndex+1<this.feedData.length,this.isSetup=!0)},this.handlePreviousBtnClick=()=>{const t=this.feedData[this.currentIndex-1];document.querySelector(`[slot=mod-queue-feed] mod-queue-list-item[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-post[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-profile-comment[comment-id="${t}"] *`)?.click()},this.handleNextBtnClick=()=>{const t=this.feedData[this.currentIndex+1];document.querySelector(`[slot=mod-queue-feed] mod-queue-list-item[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-post[id="${t}"] a[slot=full-post-link], [slot=mod-queue-feed] shreddit-profile-comment[comment-id="${t}"] *`)?.click()}}connectedCallback(){super.connectedCallback(),this.setup()}render(){return this.isSetup?y`<div class="flex">\n ${S({appearance:"plain",attributes:{type:"button","aria-label":"Previous post",disabled:!this.hasPrevious,onclick:this.handlePreviousBtnClick},leadingIcon:A({size:x.Small}),size:g.Small})}\n ${S({appearance:"plain",attributes:{type:"button","data-label":"pdp-post-close","aria-label":"Next post",disabled:!this.hasNext,onclick:this.handleNextBtnClick},leadingIcon:I({size:x.Small}),size:g.Small})}\n </div>`:M}};w.styles=[T],t([s({type:String,attribute:"thing-id"})],w.prototype,"thingId",void 0),t([e()],w.prototype,"isSetup",void 0),t([e()],w.prototype,"hasPrevious",void 0),t([e()],w.prototype,"hasNext",void 0),t([e()],w.prototype,"feedData",void 0),t([e()],w.prototype,"currentIndex",void 0),w=t([i("mod-queue-pdp-pagination-buttons")],w);let _=class extends v{constructor(){super(...arguments),this.isVisible=!1,this.handleScroll=t=>{const e=t.target.scrollTop;this.isVisible=e>60}}connectedCallback(){super.connectedCallback();this.closest('[slot="pdp-panel"]')?.addEventListener("scroll",this.handleScroll)}disconnectedCallback(){super.disconnectedCallback();this.closest('[slot="pdp-panel"]')?.removeEventListener("scroll",this.handleScroll)}render(){return this.isVisible?y`<div \n class="bg-neutral-background z-[2] flex justify-end absolute right-md shadow-md p-2xs rounded-full mt-sm" \n>\n <slot name="pagination"></slot>\n <slot name="close"></slot>\n </div>`:M}};_.styles=[T],t([e()],_.prototype,"isVisible",void 0),_=t([i("mod-queue-pdp-floating-ctas")],_);let L=class extends v{constructor(){super(...arguments),this.isMobile=!1,this.showDurationS=8,this.postId="",this.isPillVisible=!1,this.hostCommentCount=0,this.isAddedTabEvent=!1,this.commentCountSubscriptionController=new C(this),this.onData=t=>{this.isAddedTabEvent||(document.querySelector(`.${k}`)?.addEventListener("click",this.handleAmaCommentTabClick),this.isAddedTabEvent=!0);const e=t.subscribe.data.hostCommentCountChange||0;e<=0||(this.hostCommentCount+=e,this.isPillVisible?clearTimeout(this.currentCountDown):this.isPillVisible=!0,this.currentCountDown=setTimeout((()=>{this.isPillVisible=!1}),1e3*this.showDurationS))},this.scrollToCommentsAndRefreshAnswers=()=>{const t=document.querySelector(`.${k}`)?.offsetTop;if(!t)return;const e=document.querySelector("nav")?.offsetHeight??0;window.scrollTo({top:t-e,behavior:"smooth"});document.querySelector('button[value="answered"]')?.click()},this.onPillClick=()=>{this.isPillVisible=!1,this.hostCommentCount=0,this.currentCountDown&&clearTimeout(this.currentCountDown),this.currentCountDown=void 0,this.scrollToCommentsAndRefreshAnswers()},this.handleAmaCommentTabClick=t=>{const e=t.target?.getAttribute("value"),s=e&&e.toLowerCase();"all"!==s&&"answered"!==s||(this.isPillVisible=!1,this.hostCommentCount=0,this.currentCountDown&&clearTimeout(this.currentCountDown))}}static get styles(){return[E`:host{left:50%;position:fixed;top:calc(var(--shreddit-header-height) + 32px);transform:translateX(-50%);z-index:1001}`,T]}getTitleText(){const t=this.hostCommentCount;return P({count:t,single:`${t} new answer`,many:`${t} new answers`})}connectedCallback(){super.connectedCallback(),this.commentCountSubscriptionController.subscribe({query:{operationName:"SubscribeSubscription",query:"\n          subscription SubscribeSubscription($input: SubscribeInput!) {\n            subscribe(input: $input) {\n              ... on BasicMessage {\n                data {\n                  ... on CommentCountUpdateMessageData {\n                    hostCommentCountChange\n                  }\n                }\n              }\n            }\n          }\n          ",variables:{input:{channel:{teamOwner:"CONTENT_AND_COMMUNITIES",category:"COMMENT_COUNT_UPDATE",postID:this.postId}}}},onData:t=>{t.data&&this.onData(t.data)}})}disconnectedCallback(){super.disconnectedCallback(),document.querySelector(`.${k}`)?.removeEventListener("click",this.handleAmaCommentTabClick)}render(){return this.isPillVisible?S({appearance:"primary",attributes:{onclick:this.onPillClick},children:this.getTitleText(),size:this.isMobile?g.Small:g.Large,role:"button"}):M}};t([s({type:Boolean,attribute:"is-mobile"})],L.prototype,"isMobile",void 0),t([s({type:Number,attribute:"show-duration-in-s"})],L.prototype,"showDurationS",void 0),t([s({type:String,attribute:"post-id"})],L.prototype,"postId",void 0),t([e()],L.prototype,"isPillVisible",void 0),t([e()],L.prototype,"hostCommentCount",void 0),L=t([i("ama-new-comment-pill")],L);
//# sourceMappingURL=pdp-post-client-js-4eced1f6.js.map
