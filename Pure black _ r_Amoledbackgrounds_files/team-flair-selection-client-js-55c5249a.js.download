import{l as e,ae as t,W as s,A as a,B as i,g as r,k as o,aF as n,aG as l,b as d,c,a as p,_ as u,w as h,n as m,e as b}from"./shell-97fd3bd7.js";import{x as f,y,I as S,s as w}from"./icon-6e78539e.js";import{l as v,L as g}from"./list-item-5402a18e.js";import"./faceplate-bottom-sheet-header-16ee3868.js";import"./faceplate-bottom-sheet-bd14a9d4.js";import"./faceplate-modal-8fdeb7ac.js";import"./TinyGesture-6f7cc1aa.js";const T=({actionReason:s,subredditId:a,subredditName:i})=>e({source:"global",action:"view",noun:"screen"},{action_info:{page_type:t.FlairsList,reason:s},subreddit:{id:a,name:i}}),x=({eventType:t,actionReason:s,subredditId:a,subredditName:i,flairId:r,flairText:o})=>e({source:"flair_prompt",action:"submit",noun:"flair"},{action_info:{type:t,reason:s},user_flair:{id:r,title:o},subreddit:{id:a,name:i}});var I,F,k;!function(e){e.Subreddit="community",e.Post="post_detail",e.Leaderboard="leaderboard"}(I||(I={})),function(e){e.Success="success",e.Failure="failure"}(F||(F={})),function(e){e.Emoji="emoji",e.Text="text"}(k||(k={}));const N=/:(.*?):/g;var A;!function(e){e.DEFAULT="team",e.COUNTRY="country"}(A||(A={}));let E=class extends(s(w)){constructor(){super(...arguments),this.isDesktopViewport=!1,this.subredditId="",this.subredditName="",this.username="",this.flairs=[],this.teamType=A.DEFAULT,this.actionReason=I.Subreddit,this.isAlwaysShown=!1,this.TeamTypesCopies={[A.DEFAULT]:"Team selected!",[A.COUNTRY]:"Country selected!"},this.open=()=>{const e={actionReason:this.isAlwaysShown?I.Leaderboard:this.actionReason,subredditId:this.subredditId,subredditName:this.subredditName};if(this.isDesktopViewport?this.modal?.open||(this.modal?.showModal(),this.trackEvent(T(e))):this.bottomSheet?.open||(this.bottomSheet?.showModal(),this.trackEvent(T(e))),a.isAvailable()){const e=JSON.parse(a.getItem(i.TeamFlairSelectionIsShown)||"{}");a.setItem(i.TeamFlairSelectionIsShown,JSON.stringify({...e,[this.subredditId]:!0}))}},this.close=()=>{this.isDesktopViewport?this.modal?.close():this.bottomSheet?.close()}}get flairTemplateRadioBtns(){return document.querySelectorAll('faceplate-radio-input[name="flairTemplateId"]')}firstUpdated(){requestAnimationFrame((()=>{if(a.isAvailable()){const e=JSON.parse(a.getItem(i.TeamFlairSelectionIsShown)||"{}");if(Array.isArray(e)){const t={};if(e.forEach((e=>{t[e]=!0})),a.setItem(i.TeamFlairSelectionIsShown,JSON.stringify({...t})),t[this.subredditId]&&!this.isAlwaysShown)return}if(e[this.subredditId]&&!this.isAlwaysShown)return}this.open()}))}async onFlairSelect(e,t,s){e.preventDefault();const a={actionReason:this.isAlwaysShown?I.Leaderboard:this.actionReason,flairId:t,flairText:s.toString(),subredditId:this.subredditId,subredditName:this.subredditName};try{if((await this.makeUpdateUserFlairRequest(t,s))?.data?.updateUserFlair?.ok){this.dispatchEvent(r("faceplate-alert",{level:o.success,message:this.TeamTypesCopies[this.teamType]})),this.trackEvent(x({...a,eventType:F.Success}));for(const e of this.flairTemplateRadioBtns){e.getAttribute("value")===t&&e.click()}}else this.showErrorMessage(),this.trackEvent(x({...a,eventType:F.Failure}))}catch(e){window.Sentry?.captureError?.(e),this.showErrorMessage(),this.trackEvent(x({...a,eventType:F.Failure}))}this.close()}async makeUpdateUserFlairRequest(e,t){return n({operation:l.UpdateUserFlairAndEnabledStatus,variables:{subredditId:this.subredditId??"",isEnabled:!0,flairTemplateId:e,text:t,shouldUpdateUserFlair:!0,shouldUpdateUserFlairEnabledStatus:!0,username:this.username??""}})}showErrorMessage(){this.dispatchEvent(r("faceplate-alert",{level:o.error,message:"Something went wrong"}))}getTitleText(){return"Who are you cheering for?"}renderCloseButton(){return f`<faceplate-tracker \n source="flair_prompt" \n action="click" \n noun="${t.FlairsList}" \n data-faceplate-tracking-context="${JSON.stringify({action_info:{type:"dismiss"},subreddit:{id:this.subredditId,name:this.subredditName}})}" \n slot="closeButton" \n>\n ${d({appearance:"secondary",leadingIcon:y({size:S.Small}),size:c.Small,attributes:{onclick:this.close,className:"close-button","aria-label":"Close team flair selection modal"}})}</faceplate-tracker>`}renderFlairLabel(e){if(!e.text.match(N)||!e.richtext)return{label:e.text.replace(N,"").trim()};const t=JSON.parse(e.richtext);let s="",a=f``;for(const e of t)e.e===k.Emoji&&e.u&&(a=f` <img \n alt="Custom emoji set by the subreddit moderatos" \n src="${e.u}" \n class="w-md h-md mx-xs" \n>`),e.e===k.Text&&e.t&&(s=e.t);return{label:s,leadingIcon:a}}renderFlairsList(){return f`\n ${this.flairs.map((e=>f`<faceplate-tracker \n source="flair_prompt" \n action="click" \n noun="${t.FlairsList}" \n data-faceplate-tracking-context="${JSON.stringify({action_info:{type:"choose"},subreddit:{id:this.subredditId,name:this.subredditName},user_flair:{id:e.id,title:e.text}})}" \n>${v({...this.renderFlairLabel(e),size:g.Medium,onClick:t=>this.onFlairSelect(t,e.id,e.text),attributes:{className:"w-full text-18","aria-label":`A label for ${e.text}`}})}\n </faceplate-tracker>`))}\n `}renderModal(){return f`<faceplate-modal \n ?shouldContentScroll="${!0}" \n class="z-10 rounded-lg w-[370px] max-h-[600px] s:w-[454px] m:w-[455px]" \n>\n ${this.renderCloseButton()}\n <div slot="title" class="text-18">${this.getTitleText()}</div>\n <div class="flex flex-col justify-center w-full">${this.renderFlairsList()}</div>\n </faceplate-modal>`}renderBottomSheet(){return f`<faceplate-bottom-sheet>\n <faceplate-bottom-sheet-header slot="header" has-divider>\n ${this.getTitleText()}\n <span slot="trailing"> ${this.renderCloseButton()}</span>\n </faceplate-bottom-sheet-header>\n <div class="box-border p-md pb-lg w-full overflow-y-scroll">${this.renderFlairsList()}</div>\n </faceplate-bottom-sheet>`}render(){return this.isDesktopViewport?this.renderModal():this.renderBottomSheet()}};E.styles=[p],u([h("faceplate-modal")],E.prototype,"modal",void 0),u([h("faceplate-bottom-sheet")],E.prototype,"bottomSheet",void 0),u([m({type:Boolean,attribute:"is-desktop-viewport"})],E.prototype,"isDesktopViewport",void 0),u([m({type:String,attribute:"subreddit-id"})],E.prototype,"subredditId",void 0),u([m({type:String,attribute:"subreddit-name"})],E.prototype,"subredditName",void 0),u([m({type:String,attribute:"username"})],E.prototype,"username",void 0),u([m({type:Array,attribute:"flairs"})],E.prototype,"flairs",void 0),u([m({type:String,attribute:"team-type"})],E.prototype,"teamType",void 0),u([m({type:String,attribute:"action-reason"})],E.prototype,"actionReason",void 0),u([m({type:Boolean,attribute:"is-always-shown"})],E.prototype,"isAlwaysShown",void 0),E=u([b("team-flair-selection-modal")],E);
//# sourceMappingURL=team-flair-selection-client-js-55c5249a.js.map
